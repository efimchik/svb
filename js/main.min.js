$(document).ready(function(){

	
	
	//column top sub menu
	var defaults = {
	    columns: 2,
	    classname: 'top__submenu-column',
	    min: 1
	};
	$.fn.autocolumnlist = function(params) {
	    var options = $.extend({}, defaults, params);
	    return this.each(function() {
	        var els = $(this).find('li');
	        var dimension = els.size();
	        if (dimension > 0) {
	            var elCol = Math.ceil(dimension / options.columns);
	            if (elCol < options.min) {
	                elCol = options.min;
	            }
	            var start = 0;
	            var end = elCol;
	
	            for (i = 0; i < options.columns; i++) {
	                if ((i + 1) == options.columns) {
	                    els.slice(start, end).wrapAll('<div class="' + options.classname + ' last" />');
	                } else {
	                    els.slice(start, end).wrapAll('<div class="' + options.classname + '" />');
	                }
	                start = start + elCol;
	                end = end + elCol;
	            }
	        }
	    });
	};
	
	$('.top__submenu').autocolumnlist();
	
	
	
	
	
	
	
	
	//mob top menu
	$('.top__menu-wrap').on('click', '.top__menu-mob', function() {
	    $('.top__menu-mob--closed').addClass('j-visible');
	    $('.top__menu').addClass('j-visible');
	});
	
	$('.top__menu-wrap').on('click', '.top__menu-mob--close', function() {
	    $('.top__menu-mob--closed').removeClass('j-visible');
	    $('.top__menu').removeClass('j-visible');
	    $('.top__menu-item').removeClass('top__menu-item--active');
	});
	
	
	$('.top__menu-item').on("click", function() {
	
	    if($(this).hasClass('top__menu-item--active') && $(this).hasClass('top__menu-item--curent')) {
	    	$(this).removeClass('top__menu-item--active');
	    } else {
	    	$('.top__menu-item').removeClass('top__menu-item--active');
	    	this.classList.toggle("top__menu-item--active");
	    }
	
	})
	
	
	
	$('.top__menu-wrap').on('click', '.top__submenu-item', function() {
	    $('.top__menu-mob--closed').removeClass('j-visible');
	    $('.top__menu').removeClass('j-visible');
	    $(this).parents('top__menu-item').removeClass('top__menu-item--active');
	});
	
	
	
	
	//height mod_news blocks
	// function newsResize() {
	//     var maxH = 0;
	//     var elements = document.querySelectorAll('.mod__news-item');
	
	//     for (var i = 0; i < elements.length; i++) {
	//         elements[i].setAttribute("style", "");
	//     };
	
	//     for (var i = 0; i < elements.length; i++) {
	//         if (elements[i].offsetHeight > maxH) {
	//             maxH = elements[i].offsetHeight;
	//         };
	//     };
	
	//     for (var i = 0; i < elements.length; i++) {
	//         elements[i].setAttribute("style", "height:" + maxH + "px");
	//     };
	// }
	
	
	// newsResize();
	
	// $(window).on("resize", function() {
	//     newsResize();
	// });
	
	
	
	//partners slider
	$('.partners__slider').slick({
	  dots: false,
	  infinite: true,
	  speed: 300,
	  slidesToShow: 7,
	  slidesToScroll: 1,
	  responsive: [
	    {
	      breakpoint: 1230,
	      settings: {
	        slidesToShow: 6,
	        slidesToScroll: 1
	      }
	    },
	    {
	      breakpoint: 1120,
	      settings: {
	        slidesToShow: 5,
	        slidesToScroll: 1
	      }
	    },
	    {
	      breakpoint: 960,
	      settings: {
	        slidesToShow: 4,
	        slidesToScroll: 1
	      }
	    },
	    {
	      breakpoint: 810,
	      settings: {
	        slidesToShow: 3,
	        slidesToScroll: 1
	      }
	    },
	    {
	      breakpoint: 670,
	      settings: {
	        slidesToShow: 2,
	        slidesToScroll: 1
	      }
	    },
	    {
	      breakpoint: 460,
	      settings: {
	        slidesToShow: 1,
	        slidesToScroll: 1
	      }
	    }
	  ]
	}); 
	
	
	
	
	$('.event__partners-general-slider').slick({
	  infinite: true,
	  speed: 300,
	  slidesToShow: 3,
	  slidesToScroll: 1,
	  responsive: [
	    {
	      breakpoint: 850,
	      settings: {
	        slidesToShow: 2,
	        slidesToScroll: 1
	      }
	    },
	    {
	      breakpoint: 510,
	      settings: {
	        slidesToShow: 1,
	        slidesToScroll: 1
	      }
	    }
	
	  ] 
	});
	
	
	
	
	//footer menu
	function resize() {
	    if (window.innerWidth < 640) {
	        $('.footer__menu').addClass('footer__menu--mobile');
	        $(".footer__submenu-list").hide();
	    } else {
	        $('.footer__menu').removeClass('footer__menu--mobile');
	        $(".footer__submenu-list").show();
	        $(".footer__menu-item").each(function(index, element, array) {
	            $(element).removeClass("active");
	        })
	    }
	}
	
	
	// mobile click listener
	$(".footer__menu").on("click", "li > span", function(event) {
	    if (window.innerWidth < 640) {
	        $(this).next().stop().animate({ 'height': 'toggle' }, 500).parent().toggleClass('active');
	    }
	})
	
	
	
	resize();
	
	$(window).on("resize", function() {
	    resize();
	});
	
	
	//upload profile img
	$('#image').change(function() {
	    var input = $(this)[0];
	    if ( input.files && input.files[0] ) {
	        if ( input.files[0].type.match('image.*') ) {
	            var reader = new FileReader();
	            reader.onload = function(e) {
	                $('#image_preview').attr('src', e.target.result);
	            }
	            reader.readAsDataURL(input.files[0]);
	        } else console.log('is not image mime type');
	    } else console.log('not isset files data or files API not supordet');
	});
	$('#mod__profile-form').bind('reset', function() {
	    $('#image_preview').attr('src', '');
	});
	
	
	
	
	//edit profile
	$('.mod__profile-text').on('click', '.edit__link', function() {
		$('.mod__profile').addClass('mod__profile--hidden');
		$('.mod__profile--edit').addClass('mod__profile--edit--visible');
	});
	
	
	
	
	
	//input file
	$(function(){
	    var wrapper = $( ".input__file" ),
	        inp = wrapper.find( "input" ),
	        btn = wrapper.find( "button" ),
	        lbl = wrapper.find( "div" );
	
	    btn.focus(function(){
	        inp.focus()
	    });
	    // Crutches for the :focus style:
	    inp.focus(function(){
	        wrapper.addClass( "focus" );
	    }).blur(function(){
	        wrapper.removeClass( "focus" );
	    });
	
	    var file_api = ( window.File && window.FileReader && window.FileList && window.Blob ) ? true : false;
	
	    inp.change(function(){
	        var file_name;
	        if( file_api && inp[ 0 ].files[ 0 ] ) 
	            file_name = inp[ 0 ].files[ 0 ].name;
	        else
	            file_name = inp.val().replace( "C:\\fakepath\\", '' );
	
	        if( ! file_name.length )
	            return;
	
	        if( lbl.is( ":visible" ) ){
	            lbl.text( file_name );
	            btn.text( "Выбрать" );
	        }else
	            btn.text( file_name );
	    }).change();
	
	});
	$( window ).resize(function(){
	    $( ".file_upload input" ).triggerHandler( "change" );
	});
	
	
	
	
	
	//registranion social block visible
	$('.registration__content-center').on('click', '.registration__content-link', function() {
		$('.overlay').addClass('overlay--visible');
		$('.registration__soc').addClass('registration__soc--visible');
	});
	
	$('.registration__soc').on('click', '.popup__close', function() {
		$('.overlay').removeClass('overlay--visible');
		$('.registration__soc').removeClass('registration__soc--visible');
	});
	
	$('body').on('click', '.overlay', function() {
		$(this).removeClass('overlay--visible');
		$('.registration__soc').removeClass('registration__soc--visible');
	});
	$(".tabs").each(function () {
		var tmp = $(this);
		$(tmp).find(".tabs__list-item").each(function (i) {
			$(tmp).find(".tabs__list-item:eq(" + i + ")").click(function(){
				var tab_id = i + 1;
				$(tmp).find(".tabs__list-item").removeClass("tabs__list-item--active");
				$(this).addClass("tabs__list-item--active");
				$(tmp).find(".tabs__content-item").stop(false,false).hide();
				$(tmp).find(".tab"+tab_id).stop(false,false).show();
				return false;
			});
		});
	});
	
	
	
	
	//accardion slider
	$('.b-accordion').iAccordion({
		height: '50%',
		arrNav: true,
		errors: true,
	});
	
	
	
	
	
	//edit_accardion
	var el = $('.edit__project-wrap .mod__title'),
		subEl = $('.edit__step');
	
	el.click(function() {
		var checkElement = $(this).next(subEl);		
		checkElement.stop().animate({'height':'toggle'}, 300).toggleClass('edit__step--active');
	});
	
	
	
	
	
	//edit step hidden block
	$('.edit__step-hidden-show').on('click', function() {
		$(this).stop().animate({'height': 'hide'}, 10);
		$(this).next('.edit__step-hidden').stop().animate({'height': 'show'}, 300);
	});
	$('.edit__step-hidden-hide').on('click', function() {
		$(this).parent().prev('.edit__step-hidden-show').stop().animate({'height': 'show'}, 300);
		$(this).parent('.edit__step-hidden').stop().animate({'height': 'hide'}, 200);
	});
	
	
	
	
	
	//change text
	var oldTextUp = [],
	    oldTextDown = [];
	
	function changeText() {
	    $('.fundraising__list-item').each(function(index) {
	
	        var upperDiv = $(this).children('.fundraising__list-desc:not(.fundraising__list-hidden .fundraising__list-desc)'),
	            downDiv = $(this).children('.fundraising__list-hidden').children('.fundraising__list-desc');
	
	        if (window.innerWidth < 1024) {
	            if (upperDiv.text() == oldTextDown[index]) {
	                return;
	            } else {
	                upperDiv.text(oldTextDown[index]);
	            };
	            if (downDiv.text() == oldTextUp[index]) {
	                return;
	            } else {
	                downDiv.text(oldTextUp[index]);
	            };
	        } else {
	            if (upperDiv.text() == oldTextUp[index]) {
	                return;
	            } else {
	                upperDiv.text(oldTextUp[index]);
	            };
	            if (downDiv.text() == oldTextDown[index]) {
	                return;
	            } else {
	                downDiv.text(oldTextDown[index]);
	            };
	        }
	    });
	};
	
	// init
	// add data to arrays
	$('.fundraising__list-item').each(function(index) {
	    var upperDiv = $(this).children('.fundraising__list-desc:not(.fundraising__list-hidden .fundraising__list-desc)'),
	        downDiv = $(this).children('.fundraising__list-hidden').children('.fundraising__list-desc');
	    oldTextUp.push(upperDiv.text());
	    oldTextDown.push(downDiv.text());
	});
	
	changeText();
	
	$(window).on("resize", function() {
	    changeText();
	});
	//file upload
	function addFile(element) {
	    $(element).parents(".mod__load-preview").prev().children().next().text("Файл не выбран")
	    $(element).parent().remove();
	}
	
	
	if (document.getElementById("edit__step-logo")) {
	    loadGalery.init({
	        element: document.getElementById("edit__step-logo"),
	
	        divWrapPrefix: "input__file",
	        prevContainerPrefix: "mod__load-preview",
	        albumPrefixWrap: "input__text",
	        albumPrefixTitleWrap: "edit__step-title",
	
	        isMulti: false,
	        isPreview: true,
	        isAlbum: false,
	        isAlbumLabelNested: true,
	        isAlbumPlaceholder: true,
	        isAlbumDelete: true,
	        isAddAlbum: false,
	        isPrepend: false,
	
	        text: {
	            albumInputPlaceholder: "",
	            albumLabelText: "Название альбома",
	            inputFileChoose: "Выберите файл",
	            inputFileButton: "Просмотреть файлы?",
	            addAlbumSpan: "Добавить альбом"
	        }
	
	    })
	}
	
	if (document.getElementById("edit__step-album")) {
	    loadGalery.init({
	        element: document.getElementById("edit__step-album"),
	
	        divWrapPrefix: "input__file",
	        prevContainerPrefix: "mod__load-preview",
	        albumPrefixWrap: "input__text",
	        albumPrefixTitleWrap: "edit__step-title",
	
	        isMulti: true,
	        isPreview: true,
	        isAlbum: true,
	        isAlbumLabelNested: true,
	        isAlbumPlaceholder: true,
	        isAlbumDelete: true,
	        isAddAlbum: true,
	        isPrepend: false,
	
	        text: {
	            albumInputPlaceholder: "",
	            albumLabelText: "Название альбома",
	            inputFileChoose: "Выберите файл",
	            inputFileButton: "Просмотреть файлы?",
	            addAlbumSpan: "Добавить sos альбом"
	        }
	
	    });
	}
	
	
	
	
	//delete image event listener
	$(".mod__load-preview-del").on("click", function(event) {
	    event.preventDefault();
	    addFile(this);
	});
	
	
	
	
	//scroll bar
	$('.options_wrap').mCustomScrollbar();
	$('.mod__widget-area').mCustomScrollbar();
	
	
	
	
	//add comment panel
	$('.mod__widget-button').on('click', function () {
		$('.mod__widget-add-comment').addClass('mod__widget-add-comment--active');
	});
	
	$('.mod__widget-add-comment').on('click', '.popup__btn-close', function () {
		$(this).parent().removeClass('mod__widget-add-comment--active');
	});
	
	
	
	
	//event popup
	//---first popup
	$('.popup__event-change1').on('click', '.mod__widget-button', function () {
		$('.popup__event-change1').removeClass('j-visible');
		$('.popup__event-change2').addClass('j-visible');
	});
	
	$('.popup__event-change2').on('click', '.popup__event-back', function () {
		$('.popup__event-change2').removeClass('j-visible');
		$('.popup__event-change1').addClass('j-visible');
	});
	
	
	$('.popup__event-change2').on('click', '.mod__widget-button', function () {
	
		
	
		if($('#forme').is(':checked')) {		
			$('.popup__event-step2').addClass('j-visible');
			$('.popup__event-step1').removeClass('j-visible');		
		}
		if($('#forcompany').is(':checked')) {		
			$('.popup__event-step3').addClass('j-visible');
			$('.popup__event-step1').removeClass('j-visible');
		}
		if($('#gift').is(':checked')) {		
			$('.popup__event-step4').addClass('j-visible');
			$('.popup__event-step1').removeClass('j-visible');
		}
	});
	
	
	
	
	
	//add fields block
	$('.popup__event-add').on('click', function () {
		$(this).prev('.input__text-double').clone(true).insertBefore($(this));
	});
	
	
	
	
	//popup steps 2
	//popup steps 2 back
	$('.popup__event-step2').on('click', '.popup__event-back', function () {
		$('.popup__event-step2').removeClass('j-visible');
		$('.popup__event-step1').addClass('j-visible');
	});
	
	//popup steps 2 next
	$('.popup__event-step2').on('click', '.mod__widget-button', function () {
		$('.popup__event-step2').removeClass('j-visible');
		$('.popup__event-step2-1').addClass('j-visible');
	});
	
	
	//popup steps 2-1
	//popup steps 2-1 back
	$('.popup__event-step2-1').on('click', '.popup__event-back', function () {
		$('.popup__event-step2-1').removeClass('j-visible');
		$('.popup__event-step2').addClass('j-visible');
	});
	
	//popup steps 2-1 next
	$('.popup__event-step2-1').on('click', '.mod__widget-button', function () {
		$('.popup__event-step2-1').removeClass('j-visible');
		$('.popup__event-step2-2').addClass('j-visible');
	});
	
	
	
	//popup steps 2-2
	//popup steps 2-2 back
	$('.popup__event-step2-2').on('click', '.popup__event-back', function () {
		$('.popup__event-step2-2').removeClass('j-visible');
		$('.popup__event-step2-1').addClass('j-visible');
	});
	
	//popup steps 2-2 next
	$('.popup__event-step2-2').on('click', '.mod__widget-button', function () {
		$('.popup__event-step2-2').removeClass('j-visible');
		$('.popup__event-step2-3').addClass('j-visible');
	});
	
	
	
	//popup steps 2-3
	//popup steps 2-3 back
	$('.popup__event-step2-3').on('click', '.popup__event-back', function () {
		$('.popup__event-step2-3').removeClass('j-visible');
		$('.popup__event-step2-2').addClass('j-visible');
	});
	
	//popup steps 2-3 next
	$('.popup__event-step2-3').on('click', '.mod__widget-button', function () {
		$('.popup__event-step2-3').removeClass('j-visible');
		$('.popup__event-step2-4').addClass('j-visible');
	});
	
	
	
	//popup steps 2-4
	//popup steps 2-4 back
	$('.popup__event-step2-4').on('click', '.popup__event-back', function () {
		$('.popup__event-step2-4').removeClass('j-visible');
		$('.popup__event-step2-3').addClass('j-visible');
	});
	
	//popup steps 2-4 next
	$('.popup__event-step2-4').on('click', '.mod__widget-button', function () {
		$('.popup__event-step2-4').removeClass('j-visible');
		$('.popup__event-step2-5').addClass('j-visible');
	});
	
	
	
	//popup steps 2-5
	//popup steps 2-5 back
	$('.popup__event-step2-5').on('click', '.popup__event-back', function () {
		$('.popup__event-step2-5').removeClass('j-visible');
		$('.popup__event-step2-4').addClass('j-visible');
	});
	
	
	
	
	//popup steps 3
	//popup steps 3 back
	$('.popup__event-step3').on('click', '.popup__event-back', function () {
		$('.popup__event-step3').removeClass('j-visible');
		$('.popup__event-step1').addClass('j-visible');
	});
	
	//popup steps 3 next
	$('.popup__event-step3').on('click', '.mod__widget-button', function () {
		$('.popup__event-step3').removeClass('j-visible');
		$('.popup__event-step3-1').addClass('j-visible');
	});
	
	
	
	
	//popup steps 3-1
	//popup steps 3-1 back
	$('.popup__event-step3-1').on('click', '.popup__event-back', function () {
		$('.popup__event-step3-1').removeClass('j-visible');
		$('.popup__event-step3').addClass('j-visible');
	});
	
	//popup steps 3-1 next
	$('.popup__event-step3-1').on('click', '.mod__widget-button', function () {
		$('.popup__event-step3-1').removeClass('j-visible');
		$('.popup__event-step3-2').addClass('j-visible');
	});
	
	
	
	
	//popup steps 3-2
	//popup steps 3-2 back
	$('.popup__event-step3-2').on('click', '.popup__event-back', function () {
		$('.popup__event-step3-2').removeClass('j-visible');
		$('.popup__event-step3-1').addClass('j-visible');
	});
	
	//popup steps 3-2 next
	$('.popup__event-step3-2').on('click', '.mod__widget-button', function () {
		$('.popup__event-step3-2').removeClass('j-visible');
		$('.popup__event-step3-3').addClass('j-visible');
	});
	
	
	
	
	//popup steps 3-3
	//popup steps 3-3 back
	$('.popup__event-step3-3').on('click', '.popup__event-back', function () {
		$('.popup__event-step3-3').removeClass('j-visible');
		$('.popup__event-step3-2').addClass('j-visible');
	});
	
	//popup steps 3-3 next
	$('.popup__event-step3-3').on('click', '.mod__widget-button', function () {
		$('.popup__event-step3-3').removeClass('j-visible');
		$('.popup__event-step3-4').addClass('j-visible');
	});
	
	
	
	
	//popup steps 3-4
	//popup steps 3-4 back
	$('.popup__event-step3-4').on('click', '.popup__event-back', function () {
		$('.popup__event-step3-4').removeClass('j-visible');
		$('.popup__event-step3-3').addClass('j-visible');
	});
	
	//popup steps 3-4 next
	$('.popup__event-step3-4').on('click', '.mod__widget-button', function () {
		$('.popup__event-step3-4').removeClass('j-visible');
		$('.popup__event-step3-5').addClass('j-visible');
	});
	
	
	
	
	//popup steps 3-5
	//popup steps 3-5 back
	$('.popup__event-step3-5').on('click', '.popup__event-back', function () {
		$('.popup__event-step3-5').removeClass('j-visible');
		$('.popup__event-step3-4').addClass('j-visible');
	});
	
	//popup steps 3-5 next
	$('.popup__event-step3-5').on('click', '.mod__widget-button', function () {
		$('.popup__event-step3-5').removeClass('j-visible');
		$('.popup__event-step3-6').addClass('j-visible');
	});
	
	
	
	
	//popup steps 3-6
	//popup steps 3-6 back
	$('.popup__event-step3-6').on('click', '.popup__event-back', function () {
		$('.popup__event-step3-6').removeClass('j-visible');
		$('.popup__event-step3-5').addClass('j-visible');
	});
	
	
	
	
	//popup steps 4
	//popup steps 4 back
	$('.popup__event-step4').on('click', '.popup__event-back', function () {
		$('.popup__event-step4').removeClass('j-visible');
		$('.popup__event-step1').addClass('j-visible');
	});
	
	//popup steps 4 next
	$('.popup__event-step4').on('click', '.mod__widget-button', function () {
		$('.popup__event-step4').removeClass('j-visible');
		$('.popup__event-step4-1').addClass('j-visible');
	});
	
	
	
	
	//popup steps 4-1
	//popup steps 4-1 back
	$('.popup__event-step4-1').on('click', '.popup__event-back', function () {
		$('.popup__event-step4-1').removeClass('j-visible');
		$('.popup__event-step4').addClass('j-visible');
	});
	
	
	
	
	//event paty filter
	$('.event__paty-filter-title').on('click', function(){
		$(this).toggleClass('event__paty-filter-title--active');
		$('.event__paty-filter-list').toggleClass('event__paty-filter-list--active');
	});
	
	
	$('.event__paty-filter-list').on('click', '.event__paty-filter-list-item', function(){
		$('.event__paty-list-item').css('display', 'flex');
		if ($('#low').is(':checked')) {
			$('.event__paty-list-item').css('display', 'none');
			$('.low').css('display', 'flex');
		}
		if ($('#middle').is(':checked')) {
			$('.event__paty-list-item').css('display', 'none');
			$('.middle').css('display', 'flex');
		}
	});
	//date init
	// $($.date_input.initialize);
	// 
	$(".flatpickr").flatpickr({
		dateFormat:"d F Y"
	});
	 $('.popup__galery-big').slick({
	  slidesToShow: 1,
	  slidesToScroll: 1,
	  arrows: true,
	  fade: true,
	  asNavFor: '.popup__galery-small',
	  adaptiveHeight: true
	});
	
	$('.popup__galery-small').slick({
	  slidesToShow: 8,
	  slidesToScroll: 1,
	  asNavFor: '.popup__galery-big',
	  dots: false,
	  focusOnSelect: true
	});
	
	
	//filter
	// $("#project-filter").mixItUp({
	// 	selectors: {
	// 		target: '.filter__container-item',
	// 		filter: '.filter__list-item'
	// 	}
	// });
	
	// $("#fundraising-filter").mixItUp({
	// 	selectors: {
	// 		target: '.mod__list-item',
	// 		filter: '.filter__list-item'
	// 	}
	// });
	
	
	$('.input__text-field').focus(function(){
		$(this).prev().show();
	});
	
	if($(".input__text-field").val() == ""){
		$(".input__text-label").hide();
	}
	
	
	$('.radio__wrap').on('click', function() {
		$('.popup__atlet-hidden').removeClass('open');
	
		if($('input:radio:checked')) {
			$(this).children('.popup__atlet-hidden').addClass('open');
		}
	});
	
	
	$(document).ready(indentToSlider);
	$(window).on('resize',indentToSlider);
	function indentToSlider() {
	    var indent_main = $('.partners').css('marginRight');
	    $('.mod_home-slider-text-wrap').css('marginLeft', indent_main);
	}


});